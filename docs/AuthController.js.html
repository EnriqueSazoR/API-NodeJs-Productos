<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: AuthController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: AuthController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
import { PrismaClient } from "@prisma/client";
import bcrypt from "bcrypt";
import jwt from "jsonwebtoken";
const secretKey = process.env.SECRET_KEY;
const prisma = new PrismaClient();


/**
 * Registro de un nuevo usuario
 * 
 * @async
 * @function Registro
 * @param {object} req - Objeto de solicitud debe contener {usuario, correo, password}
 * un middleware valida que los datos ingresados cumplan con los requerimientos
 * @param {object} res - Ojeto de respuesta para enviar el resultado
 * @returns {json} Mensaje de confirmación o error
 * - 200 'Ok' --> Usuario creado exitosamente y token generado
 * - 400 'Bad Request' --> Si el correo ya está en uso
 * - 500 'Internal Server Error' --> Si ocurre un error en el servidor
 * 
 * @example
 * {
 *    "usuario" : "LuisDev",
 *    "correo" : "luis@gmail.com",
 *    "password" : "Dev25$$y"  
 * }
 */
export const Registro = async (req, res) => {
  try {
  
    const { usuario, correo, password } = req.body;
    const usuarioExistente = await prisma.Usuario.findUnique({
      where: { correo },
    });
    if (usuarioExistente) {
      return res
        .status(400)
        .json({ error: "El correo ya está asociado a otra cuenta" });
    }

    // Hashear contraseña
    const hashPassword = await bcrypt.hash(password, 10);

    
    const nuevoUsuario = await prisma.Usuario.create({
      data: {
        usuario,
        correo,
        password: hashPassword,
      },
      select: {
        usuario: true,
      },
    });

    // Token
    const token = jwt.sign(
      {
        id: nuevoUsuario.id,
        correo: nuevoUsuario.correo,
      },
      secretKey,
      { expiresIn: "1h" }
    );

    res.status(200).json({
      mensaje: `Usuario ${usuario} creado exitosamente`,
      token,
    });
  } catch (error) {
    console.error(error);
    res.status(500).json({ error: "Error en el servidor" + error });
  }
};


/**
 * Iniciar Sesión
 * 
 * @async
 * @function Login
 * @param {object} req - Objeto de solicitud debe incluir {correo, password} 
 * @param {object} res - Objeto de respuesta enviando el resultado 
 * @returns {json} Mensaje de confirmación o error
 * - 200 'OK' --> Bienvenido y agrega token
 * - 400 'Bad Request' --> Si no se ingresan las credenciales
 * - 401 'Unauthorized' --> Si las credenciales no son validas
 * - 500 'Internal Server Error' --> Si hay un error en el servidor
 * 
 * @example
 * {
 *    "correo" : "LuisDev",
 *    "password" : "Dev25$$y"  
 * }
 */
export const Login = async (req, res) => {
  try {
    const { correo, password } = req.body;
    if (!correo || !password) {
      return res.status(400).json({ error: "Ambos campos son obligatorios" });
    }

    const ususarioBD = await prisma.Usuario.findUnique({ where: { correo } });
    if (!ususarioBD) {
      return res
        .status(401)
        .json({
          error: "No existe una cuenta asociada a este correo, cree una cuenta",
        });
    }

    // Validar por password
    const clave = await bcrypt.compare(password, ususarioBD.password);
    if (!clave) {
      return res.status(401).json({ error: "Credenciales Invalidas" });
    }

    // Token
    const token = jwt.sign(
      {
        id: await prisma.Usuario.id,
        correo: await prisma.Usuario.correo,
      },
      secretKey,
      { expiresIn: "1h" }
    );

    // Inciar sesion
    res.status(200).json({ Bienvenido: token });
  } catch (error) {
    console.error(error);
    return res.status(500).json({ erorr: "Problemas con servidor" });
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#GetCategorias">GetCategorias</a></li><li><a href="global.html#GetMarcas">GetMarcas</a></li><li><a href="global.html#GetProdutcos">GetProdutcos</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#PostCategoria">PostCategoria</a></li><li><a href="global.html#PostMarca">PostMarca</a></li><li><a href="global.html#PostProducto">PostProducto</a></li><li><a href="global.html#PutCategoria">PutCategoria</a></li><li><a href="global.html#PutMarca">PutMarca</a></li><li><a href="global.html#PutProducto">PutProducto</a></li><li><a href="global.html#Registro">Registro</a></li><li><a href="global.html#actualizarCredenciales">actualizarCredenciales</a></li><li><a href="global.html#buscarProducto">buscarProducto</a></li><li><a href="global.html#buscarProductoPorCategoria">buscarProductoPorCategoria</a></li><li><a href="global.html#buscarProductoPorMarca">buscarProductoPorMarca</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Thu Sep 11 2025 20:52:57 GMT-0600 (hora estándar central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
